import os
from PIL import Image
import numpy as np

MASK_MAP = [
    # body
    ['Hair','Face', 'Left-arm', 'Right-arm', 'Left-leg', 'Right-leg', 'Left-shoe', 'Right-shoe'],
    # clothes
    ['Hat', 'Glove', 'Sunglasses', 'Upper-clothes', 'Dress', 'Coat', 'Socks', 'Pants', 'Jumpsuits', 'Scarf', 'Skirt'],
    #background
    ['Background']
]
LIP_LABEL = ['Background', 'Hat', 'Hair', 'Glove', 'Sunglasses', 'Upper-clothes', 'Dress', 'Coat',
                  'Socks', 'Pants', 'Jumpsuits', 'Scarf', 'Skirt', 'Face', 'Left-arm', 'Right-arm',
                  'Left-leg', 'Right-leg', 'Left-shoe', 'Right-shoe']

'''
read mask file generated by LIP
'''
def read_person_mask(mask_path):
    if not os.path.exists(mask_path):
        return None
    with Image.open(mask_path) as mask_img:
        mask_array = np.array(mask_img,dtype=np.uint8)
    mask_out = np.zeros([3,mask_array.shape[0],mask_array.shape[1]],dtype=np.bool)
    for i in range(0,3):
        for label in MASK_MAP[i]:
            s = mask_array == LIP_LABEL.index(label)
            mask_out[i] = np.bitwise_or(mask_out[i],s)
    mask_out = mask_out.astype(np.uint8)
    return mask_out

'''
read contour map mask file
'''
def read_contour_mask(mask_path):
    if not os.path.exists(mask_path):
        return None
    with Image.open(mask_path) as mask_img:
        mask_array = np.array(mask_img,dtype=np.uint8)
    return mask_array

'''
    get person mask
    and get person contour from other file
'''
def get_person_contour_mask(mask_person_path, mask_contour_path):
    mask_out_p = read_person_mask(mask_person_path)
    mask_out_c = read_contour_mask(mask_contour_path)
    mask_out_p[2] = mask_out_c
    return mask_out_p

if __name__ == '__main__':
    mask = read_person_mask('../../DATASET/LTCC_ReID/train-mask/000_1_c2_001038.png')
    mask_contour = read_contour_mask('../../DATASET/LTCC_ReID/train_rend/000_1_c2_001038.png')
    mask_total = get_person_contour_mask('../../DATASET/LTCC_ReID/train-mask/000_1_c2_001038.png'
                                  ,'../../DATASET/LTCC_ReID/train_rend/000_1_c2_001038.png')
    print('finish')